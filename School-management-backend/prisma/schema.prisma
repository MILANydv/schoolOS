generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model School {
  id        String   @id @default(uuid())
  name      String
  email     String
  phone     String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  users         User[]
  students      Student[]
  classes       Class[]
  teachers      Teacher[]
  fees          Fee[]
  attendance    Attendance[]
  notifications Notification[]
  events        Event[]
  exams         Exam[]
  timetables    Timetable[]
  logs          Log[]
  admissions    Admission[]
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      String
  firstName String
  lastName  String
  phone     String?
  schoolId  String
  status    String   @default("ACTIVE")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  school  School   @relation(fields: [schoolId], references: [id])
  logs    Log[]
  teacher Teacher?
  student Student?
}

model Student {
  id              String   @id @default(uuid())
  schoolId        String
  userId          String?  @unique
  rollNumber      String
  firstName       String
  lastName        String
  dateOfBirth     DateTime
  gender          String
  email           String?
  phone           String?
  classId         String
  section         String
  admissionDate   DateTime
  admissionNumber String   @unique
  status          String   @default("ACTIVE")
  
  addressStreet   String
  addressCity     String
  addressState    String
  addressZip      String
  
  parentName      String
  parentPhone     String
  parentEmail     String
  
  emergencyName   String
  emergencyPhone  String
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  school     School       @relation(fields: [schoolId], references: [id])
  user       User?        @relation(fields: [userId], references: [id])
  class      Class        @relation(fields: [classId], references: [id])
  attendance Attendance[]
  fees       Fee[]
  results    Result[]
  
  @@unique([schoolId, rollNumber])
}

model Class {
  id           String   @id @default(uuid())
  schoolId     String
  name         String
  section      String
  grade        String
  academicYear String
  capacity     Int
  roomNumber   String?
  status       String   @default("ACTIVE")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  school     School       @relation(fields: [schoolId], references: [id])
  students   Student[]
  attendance Attendance[]
  exams      Exam[]
  timetable  Timetable[]
}

model Teacher {
  id            String   @id @default(uuid())
  schoolId      String
  userId        String   @unique
  employeeId    String   @unique
  department    String?
  qualification String
  experience    Int
  joinDate      DateTime
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  school    School      @relation(fields: [schoolId], references: [id])
  user      User        @relation(fields: [userId], references: [id])
  timetable Timetable[]
}

model Attendance {
  id        String   @id @default(uuid())
  schoolId  String
  studentId String
  classId   String
  date      DateTime
  status    String
  remarks   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  school  School  @relation(fields: [schoolId], references: [id])
  student Student @relation(fields: [studentId], references: [id])
  class   Class   @relation(fields: [classId], references: [id])
  
  @@unique([studentId, date])
}

model Fee {
  id           String   @id @default(uuid())
  schoolId     String
  studentId    String
  feeType      String
  totalAmount  Float
  paidAmount   Float    @default(0)
  dueDate      DateTime
  status       String   @default("DUE")
  academicYear String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  school   School       @relation(fields: [schoolId], references: [id])
  student  Student      @relation(fields: [studentId], references: [id])
  payments FeePayment[]
}

model FeePayment {
  id            String   @id @default(uuid())
  feeId         String
  amount        Float
  paymentMethod String
  paymentDate   DateTime
  receiptNumber String   @unique
  createdAt     DateTime @default(now())
  
  fee Fee @relation(fields: [feeId], references: [id])
}

model Notification {
  id        String   @id @default(uuid())
  schoolId  String
  title     String
  content   String
  type      String
  priority  String
  audience  String[]
  status    String   @default("DRAFT")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  school School @relation(fields: [schoolId], references: [id])
}

model Event {
  id          String   @id @default(uuid())
  schoolId    String
  title       String
  description String?
  date        DateTime
  startTime   String?
  endTime     String?
  location    String?
  type        String
  audience    String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  school      School   @relation(fields: [schoolId], references: [id])
}

model Exam {
  id          String   @id @default(uuid())
  schoolId    String
  classId     String
  subject     String
  name        String
  date        DateTime
  startTime   String
  duration    Int
  totalMarks  Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  school      School   @relation(fields: [schoolId], references: [id])
  class       Class    @relation(fields: [classId], references: [id])
  results     Result[]
}

model Result {
  id        String   @id @default(uuid())
  examId    String
  studentId String
  marksObtained Float
  grade     String?
  remarks   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  exam      Exam     @relation(fields: [examId], references: [id])
  student   Student  @relation(fields: [studentId], references: [id])
}

model Timetable {
  id          String   @id @default(uuid())
  schoolId    String
  classId     String
  dayOfWeek   String
  startTime   String
  endTime     String
  subject     String
  teacherId   String?
  roomNumber  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  school      School   @relation(fields: [schoolId], references: [id])
  class       Class    @relation(fields: [classId], references: [id])
  teacher     Teacher? @relation(fields: [teacherId], references: [id])
}

model Log {
  id        String   @id @default(uuid())
  schoolId  String
  userId    String?
  action    String
  details   String?
  ipAddress String?
  createdAt DateTime @default(now())

  school    School   @relation(fields: [schoolId], references: [id])
  user      User?    @relation(fields: [userId], references: [id])
}

model Admission {
  id               String   @id @default(uuid())
  schoolId         String
  applicantName    String
  gradeApplyingFor String
  applicationDate  DateTime
  status           String   @default("Pending")
  contact          String
  notes            String?
  statusHistory    Json?    // Storing history as JSON for flexibility
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  school           School   @relation(fields: [schoolId], references: [id])
}
